DEMO
===========================
########### system version

V1.0

########### Environment depends on

python 3.7+


########### Operation mode

windows Environment
1. Run directly from the command line (after configuring the Python environment)
    Open DOS switch to the code in the path directly run the following format code
     python .\convertInspurokl.py -p file_path
    Where file_path is the path of the log data that you need to extract, such as C :\logs

2. Download an advanced Python editor, such as Pycharm, by running the program in the IDE
    <i> Modify the parser.add_argument("-i", "--input", help="The single ErrorAnalyReport.json.")
    add a parameter through the default property
    <2> Add by going to the Parameters for Edit Configurations

   
########### Directory Structure Description

├── Readme.md                   // help
├── configuration.py            // configuration
├── convertInspurokl.py         // main()
├── parse_analy_report.py       // ErrorAnalyReport File conversion program
├── parse_component_log.py      // component_log File conversion program
├── parse_regrawdata.py         // RegRawData File conversion program
├── util.py                     // Tool function library 
├── cpx_inspurrawreg.txt        // cpx Register mapping configuration file
├── cpx_opcode_def.py           // cpx_tor_dump configuration file       
├── icx_inspurrawreg.txt        // icx Register mapping configuration file    
├── icx_opcodes_def.py          // icx_tor_dump configuration file   
└── convertor_log.log           // The log file saved when the program runs


###########程序函数功能

1. convertInspurokl.py
<1> convert(args_input, args_path, args_cpu)

        *  according to the input args_input、args_path and args_cpu, to use parse_logs() to generate 
           the corresponding converted JSON file.
        @param - args_input: The single ErrorAnalyReport.json.  
        @param - args_path: The path for ErrorAnalyReport.json files, it will analyze all files in 
                 the path.   
        @param - args_cpu: Indicate the cpu type(icx, cpx) of the input file.  
        return - error_list: All error messages generated by running the parse_log() function.  

<2> parse_logs(report_filename, args_cpu)

        *  according to the input report_filename, deal the corresponding component.log、
           ErrorAnalyReport.json and RegRawData.json files, generate the corresponding 
           converted JSON file.
        @param - report_filename: The single ErrorAnalyReport.json.  
        @param - args_cpu: Indicate the cpu type(icx, cpx) of the input file.  
        return - error_list: All error messages generated by convert the corresponding component.log、 
                 ErrorAnalyReport.json and RegRawData.json file.    


2. parse_component_log.py
<1> get_component_info(log_filename, rawdata_filename, log_cputype_re, raw_cputype_re, args_cpu)

        * according to the input log_filename and rawdata_filename, deal the corresponding component.log
          and RegRawData.json file, return component_info that contains "fw_info" and "cpu_dict".
        @param - log_filename: The single component.log.  
        @param - rawdata_filename: The single RegRawData.json. 
        @param - log_cputype_re: "log_cputype_re" in configuration.py file,is the regular expression
                 for the cpu_type data part in the component_log file.
        @param - raw_cputype_re: "raw_cputype_re" in configuration.py file, is the regular expression
                 for the cpu_type data part in the RegRawData.json file.
        @param - args_cpu: Indicate the cpu type(icx, cpx) of the input file.
        return - component_info: component is a dict, include "fw_info" and "cpu_dict" attributes, 
                 "fw_info" is from Errorcomponent.log, and "cpu_dict" is from Errorcomponent.log、
                 RegRawData.json and args_cpu. 
        
<2> get_fwinfo_bylog(log_filename)

        *  according to the input log_filename, deal the corresponding component_log file, return the
           fw_info that contains "bmc_fw_version"、"bios_id" and "me_fw_ver".
        @param - log_filename: The single component.log.  
        return - fw_info: fw_info is a dict, "fw_info" is from Errorcomponent.log.

<3> get_cpudict_byall(log_filename, rawdata_filename, log_cputype_re, raw_cputype_re, args_cpu=None)

        *  according to the input component_log、RegRawData.json file and args_cpu, return the cpu_dict
           that contains "cpu_type"、"ver_id"、"sockets" and "cpu_info".
        @param - log_filename: The single component.log.  
        @param - rawdata_filename: The single RegRawData.json. 
        @param - log_cputype_re: "log_cputype_re" in configuration.py file,is the regular expression 
                 for the cpu_type data part in the component_log file.
        @param - raw_cputype_re: "raw_cputype_re" in configuration.py file, is the regular expression
                 for the cpu_type data part in the RegRawData.json file.
        @param - args_cpu: Indicate the cpu type(icx, cpx) of the input file.
        return - cpu_dict: cpu_dict is a dict, include "cpu_type"、"ver_id"、"sockets" and "cpu_info" 
                 attributes.

<4> get_cpudict_verid_sockets_bylog(log_filename, log_cputype_re)

        *  according to the input log_filename, use the input log_cputype_re to deal the corresponding
           component_log file, return the cpu_dict that contains "cpu_type"、"ver_id"、"sockets" and 
           "cpu_info".
        @param - log_filename: The single component.log. 
        @param - log_cputype_re: "log_cputype_re" in configuration.py file,is the regular expression 
                 for the cpu_type data part in the component_log file.
        return - cpu_dict: cpu_dict is a dict, include "cpu_type"、"ver_id"、"sockets" and "cpu_info" 
                 attributes.

<5> get_cpudict_byregrawdata_argscpu(rawdata_filename, raw_cputype_re, args_cpu=None)

        *  according to the input rawdata_filename and args_cpu, use the input raw_cputype_re to deal 
           the corresponding component_log file, return the cpu_dict that contains "cpu_type"、"ver_id"、
           "sockets" and "cpu_info".
        @param - rawdata_filename: The single RegRawData.json. 
        @param - raw_cputype_re: "raw_cputype_re" in configuration.py file, is the regular expression 
                 for the cpu_type data part in the RegRawData.json file.
        @param - args_cpu: Indicate the cpu type(icx, cpx) of the input file.
        return - cpu_dict: cpu_dict is a dict, include "cpu_type"、"ver_id"、"sockets" and "cpu_info" 
                 attributes.

3. parse_analy_report.py
<1> deal_report(report_filename, component_info)

        * according to the input report_filename and component_info, deal the corresponding 
          ErrorAnalyReport.json file, generate the corresponding converted JSON file.
        @param - report_filename: The single ErrorAnalyReport.json.
        @param - component_info: the function get_component_info()'s return value.
        return - all_log_list, error_list: 
        all_log_list: a list contains all crash_dump information in the report_filename file. 
        error_list: All error messages generated by convert the ErrorAnalyReport.json file.    

4. parse_regrawdata.py
<1> deal_regrawdata(rawdata_filename, component_info, all_list=[])

        * according to the input rawdata_filename、component_info and all_list,  deal the corresponding
          RegRawData.json file, generate the corresponding converted JSON file. The contains of all_list
          is all crash_dump information in the corresponding ErrorAnalyReport.json file, The default value
          for all_list is a empty list(just []), if all_list has an incoming value that is not empty list,
          the data written in the generated conversion file is the result of merging the corresponding 
          ErrorAnalyReport.json and RegRawData.json files.
        @param - rawdata_filename: The single ErrorAnalyReport.json.
        @param - component_info: The single ErrorAnalyReport.json.
        @param - component_info: the get_component_info's return value. 
        return - all_log_list, error_list: 
        all_log_list: a list contains all crash_dump information in the report_filename file.
        error_list: All error messages generated by convert the ErrorAnalyReport.json file. 

<2> deal_regrawdata_cha(ret_dict, cha_data)

        * according to the input ret_dict and cha_data(cha_data is the "Raw CHA Register Data" in log,
          and the log is one of the "RegisterDataLog" list in RegRawData.json file), return the updated 
          ret_dict.
        @param - ret_dict: ret_dict is a dict that stores information about registers in the 
                 RegRawData.json file.
        @param - cha_data: cha_data is a list, just the "Raw CHA Register Data" in log.
        return - ret_dict: ret_dict is a dict, just add the information in the cha_data list to the 
                 ret_dict and return.

<3> update_cha_dict(cha_dict, key, val)

        * this function is an implementation that adds a key and val from the cha_data list to ret_dict.
        @param - cha_dict: cha_dict is a dict that stores information about registers in the 
                 RegRawData.json file.
        @param - key: key is a register name in the cha_data list.
        @param - val: val is the value of key in the cha_data list.
        return - cha_dict: cha_dict is a dict, just add key and val to the cha_dict and return.

<4> deal_regrawdata_mca(ret_dict, mca_data)

        * according to the input ret_dict and mca_data(mca_data is the "Msr Register Data" in log, and the 
          log is one of the "RegisterDataLog" list in RegRawData.json file), return the updated ret_dict.
        @param - ret_dict: ret_dict is a dict that stores information about registers in the RegRawData.json file.
        @param - mca_data: mca_data is a list, just the "Msr Register Data" in log.
        return - ret_dict: ret_dict is a dict, just add the information in the mca_data list to the ret_dict
                 and return.

<5> update_mca_dict(mca_dict, key, val)

        * this function is an implementation that adds a key and val from the mca_data list to ret_dict.
        @param - mca_dict: mca_dict is a dict that stores information about registers in the RegRawData.json file.
        @param - key: key is a register name in the mca_data list.
        @param - val: val is the value of key in the mca_data list.
        return - mca_dict: mca_dict is a dict, just add key and val to the mca_dict and return.

<6> deal_regrawdata_csr(ret_dict, csr_data, cpu_type)

        * according to the input ret_dict、csr_data(csr_data is the "Csr Register Data" in log, and the log is one of 
          the "RegisterDataLog" list in RegRawData.json file) and cpu_type, return the updated ret_dict.
        @param - ret_dict: ret_dict is a dict that stores information about registers in the RegRawData.json file.
        @param - csr_data: csr_data is a list, just the "Csr Register Data" in log.
        @param - cpu_type: cpu_type is the CPU type of the regrawData.json file.
        return - ret_dict: ret_dict is a dict, just add the information in the csr_data list to the ret_dict and return.

<7> update_csr_dict(csr_dict, key, val, cpu_type)

        * this function is an implementation that adds a key and val from the csr_data list to ret_dict.
        @param - csr_dict: csr_dict is a dict that stores information about registers in the RegRawData.json file.
        @param - key: key is a register name in the csr_data list.
        @param - val: val is the value of key in the csr_data list.
        @param - cpu_type: cpu_type is the CPU type of the regrawData.json file.
        return - csr_dict: csr_dict is a dict, just add key and val to the csr_dict and return.

5. util.py
<1> get_dict_by_conf(cof_file, target, txt)

        * get the regular expression of the target section from the configuration.py,
          to regularize the TXT text, return a dict
        @param - cof_file: cof_file is Configuration file name, default value is configuration.py.
        @param - target: target is a key in the configuration file, the corresponding values of target are 
                 regularized expressions.
        @param - txt: txt is a string, prepare for a regular match.
        return - ret: ret is a dict, saves the result after the target regularization expression to matches the txt.

<2> deal_bankid_None(txt, target)

        * If the regular expression of the bank_id field in Configuration.py does not obtain a correct value, 
          the bank_id field in the errorAnalyreport.json file is added to the log and printed.
        @param - txt: txt is a text, just a string or a dict. 
        @param - target: target is a string that is used to regularize the text to determine whether the target 
                 field exists in the txt.
        return - ret: ret is a boolean value, if target was successfully matched in txt, return true. otherwise, 
                 return false.

<3> get_file_list(temp = None)

        * If the temp is a string, the contents of the file are read by line with
          newlines and whitespace removed and stored in the list.if temp is a dict,
          the dict is converted to a string, Remove newlines, whitespace from that, 
          in finally, cut into a list based on commas, if temp is the other type， 
          print the error info in logs and return a empty list(just []).
        @param - temp: temp is a text, just a string or a dict. if the other type, print the error info in logs
                 and return a empty list(just []).
        return - ret_list: If the temp is a string or dict, return the ret_list that contains the contents of the
                 temp. otherwise, return an empty list(just []).

<4> _read_json(filename=None)

        * read filename's data and return data of json
        @param - filename: filename is the name of the file to be read.
        return - json_object, error_list:
        json_object: if the file is read successfully, json_Object stores the data of the corresponding file in
        JSON format, otherwise, json_Object is null.
        error_list: if the read is successful, the error_list is an empty list(just []). If the read is not 
        successful, the error_list contains the read error information.

<5> generate_file(filename, new_crashdump, i)

        * according to the input new_crashdump data, generate the corresponding converted JSON file.
        @param - filename: the filename is want to generation.
        @param - new_crashdump: new_crashdump is a dict, new_crashdump contains data that will be written to the file.
        @param - i: the index number of the generated file.
        return - None

<6> get_file_retxt(temp = None)

        * If the temp is a string, the contents of the file are read by line to
          remove whitespace and concatenate the contents of all lines into a string.
          If temp is a dict, the temp will be converted to a string, then Remove 
          whitespace from that and return. if the other type， print the error info and return a empty string(just "").
        @param - filename: txt is a text, just a string or a dict. if the other type, print the error info in 
                 logs and return a empty string(just "").
        return - txt: If the temp is a string or dict, return the txt that contains the contents of the temp. 
                 otherwise, return an empty string(just "").

<7> get_report_icx_TOR_dump(Errorlist)

        * according to the input CPU type is ICX's Errorlist, use function covert_icx_tor_dump() to do some conversion,
          return tor_data.
        @param - Errorlist: Errorlist contains Some register information, it is the "ErrorEntry" list in the 
                 errorAnalyreport.json file.
        return - tor_data: tor_data is a dict that contains the corresponding TOR_dump infomation.
        
<8> get_report_cpx_TOR_dump(Errorlist)

        * according to the input CPU type is CPX's Errorlist, use function covert_icx_tor_dump() to do some conversion,
          return tor_data.
        @param - Errorlist: Errorlist contains Some register information, it is the "ErrorEntry" list in the 
                 ErrorAnalyreport.json file.
        return - tor_data: tor_data is a dict that contains the corresponding TOR_dump infomation.

<9> reset_dic(dict_a)

        * reset the val in the dict_a, except for the key is '_version'.
        @param - dict_a: dict_a is a dict that need to be reset.
        return - None

<10> get_dic_key(key_list, value)

        * according to the input key_list and value, generate a tree dict to return.
        @param - key_list: key_list is a list that contains the path information of dict. 
        @param - value: is a value to be stored in dict.
        return - {key_list[0]: get_dic_key(key_list[1:], value)} or {key_list[0]: value}: return a dict.

<11> cpx_reg_mapping(reg, value, cpuinfo)

        * CPU type is CPX's register name conversion mapping.
        @param - reg: reg is a register name in ErrorAnalyreport.json file's "REGISTER DUMP".
        @param - value: the value corresponding to reg.
        @param - cpuinfo: cpuinfo is a dict that contains "socket_id"、"core_id"、"thread_id"、"cha_id" and "bank_id".
        return - data_dic: data_dict is a dict that contains information about reg and value.

<12> ipx_reg_mapping(reg, value, cpuinfo)

        * CPU type is ICX's register name conversion mapping.
        @param - reg: reg is a register name in ErrorAnalyreport.json file's "REGISTER DUMP".
        @param - value: the value corresponding to reg.
        @param - cpuinfo: cpuinfo is a dict that contains "socket_id"、"core_id"、"thread_id"、"cha_id" and "bank_id".
        return - data_dic: data_dict is a dict that contains information about reg and value.

<13> merge_dic(dic1, dic2)

        * merge the dict2 to dict1
        @param - dic1: is a dict.
        @param - dic2: is a dict.
        return - dic1: update the dit2 to the dic1 and return dic1.

<14> init_logger(logfile="convertor_log.log")

        * Initialize the logger.
        @param - logfile: logfile is the name of the generated log file.
        return - None

<15> write_log(log_text)

        * Write the log.
        @param - log_text: the text that will be written into the log.
        return - None

<15> stop_logger()

        * close write files.
        return - None

###########V1.0 版本内容更新
1. 新功能     aaaaaaaaa
2. 新功能     bbbbbbbbb
3. 新功能     ccccccccc
4. 新功能     ddddddddd